package EstudoAPS;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;

public class ComparaDados {
    public static String compararMeses(String mes1, String mes2, String coluna) {
        StringBuilder resultado = new StringBuilder();
        try (Connection conn = ConexaoBD.conectar()) {
            String sql = "SELECT mes, casos, vacinados, " + coluna + " FROM doencas WHERE mes = ? OR mes = ?";
            PreparedStatement pstmt = conn.prepareStatement(sql);
            pstmt.setString(1, mes1);
            pstmt.setString(2, mes2);
            ResultSet rs = pstmt.executeQuery();

            int casosMes1 = -1, casosMes2 = -1;
            int vacMes1 = -1, vacMes2 = -1;
            int colunaMes1 = -1, colunaMes2 = -1;

            while (rs.next()) {
                if (rs.getString("mes").equalsIgnoreCase(mes1)) {
                    casosMes1 = rs.getInt("casos");
                    vacMes1 = rs.getInt("vacinados");
                    colunaMes1 = rs.getInt(coluna);
                } else if (rs.getString("mes").equalsIgnoreCase(mes2)) {
                    casosMes2 = rs.getInt("casos");
                    vacMes2 = rs.getInt("vacinados");
                    colunaMes2 = rs.getInt(coluna);
                }
            }

            if (casosMes1 != -1 && casosMes2 != -1) {
                double variacaoCasos = ((double)(casosMes2 - casosMes1) / casosMes1) * 100;
                resultado.append(String.format("Variação de casos de %s para %s: %.2f%%\n", mes1, mes2, variacaoCasos));
            } else {
                resultado.append("Não há dados suficientes sobre casos.\n");
            }

            if (vacMes1 != -1 && vacMes2 != -1) {
                double variacaoVacinas = ((double)(vacMes2 - vacMes1) / vacMes1) * 100;
                resultado.append(String.format("Variação de vacinados de %s para %s: %.2f%%\n", mes1, mes2, variacaoVacinas));
            } else {
                resultado.append("Não há dados suficientes sobre vacinados.\n");
            }

            if (colunaMes1 != -1 && colunaMes2 != -1) {
                double variacaoColuna = ((double)(colunaMes2 - colunaMes1) / colunaMes1) * 100;
                resultado.append(String.format("Variação de '%s' de %s para %s: %.2f%%\n", coluna, mes1, mes2, variacaoColuna));
            } else {
                resultado.append("Não há dados suficientes para a coluna '" + coluna + "'.\n");
            }

        } catch (SQLException e) {
            resultado.append("Erro: ").append(e.getMessage());
        }

        return resultado.toString();
    }
}
